# no_a2l_demo Demo

## A2L Generation
  
Demonstrates options how to create an A2L file without the XCPlite typical runtime A2L creator code instrumentation.  

## Using the xcp_client tool

The xcp_client tool from Rust xcp-lite can generate A2L file templates for further processing with other tools or complete A2L files with all visible measurement and calibration variables.

To generate the correct event ids and calibration segment number needed in the XCP protocol, the application must be running on the target to enable xcp_client to upload event and calibration segment information via XCP. Otherwise this has to be done in the XCP tool. CANape currently only detects event, but not calibration segment informaation.

Example: Create a template

```bash
$xcp_client   --dest-addr=$TARGET_HOST:5555 --tcp --create-a2l --a2l no_a2l_demo.a2l
```

Example: Create measurement and calibration variable from a binary file with ELF/DWARF debug information

```bash
$xcp_client   --dest-addr=$TARGET_HOST:5555 --tcp --elf no_a2l_demo.out  --a2l no_a2l_demo.a2l
```

Refer to the xcp_client command line parameter description for details.  

The A2L file template can now be modified, extended and updated with CANape or any other A2L tool.
This approach works for global measurement variables and calibration parameters.  
XCPlite must be configured for absolute calibration segment addressing (OPTION_CAL_SEGMENTS_ABS).  

To make local variables visible, they have to live on stack which is usually not true with optimized code.
There is a macro XCP_MEA to spill local variables to stack with minimal runtime overhead.

Example:

```bash
XCP_MEA uint8_t counter = 0;
```

.

### Using Vector CANape

Drop the template generated by xcp_client into CANape and create a new XCP on Ethernet device.  
Enable access to the ELF file in the device configuration.  
Use the A2L editor to add individual measurement parameters.  
For calibration create an calibration instance for the complete calibration parameter struct.

### Using Vector A2L-Toolset A2L-Creator to add measurement and calibration metadata

The example code contains some A2L creator metadata annotation to add metadata such as calibration variable limits and physical units

### Using Open Source a2ltool

Example:
Add the calibration segment 'params' and the measurment variable 'counter' to the A2L template:

```bash
a2ltool  --update --measurement-regex "counter"  --characteristic-regex "params" --elffile  no_a2l_demo.out  --enable-structures --output no_a2l_demo.out no_a2l_demo.out 
```

### Demo

The demo script create_a2l.sh automates the complete remote build and A2L generation process.

```bash
./create_a2l.sh
```

### Work in progress

This is currently experimental.  
The approach will be used for the upcoming ThreadX demo with build time A2L generation.

objdump -W no_a2l_demo.out
objdump --all-headers no_a2l_demo.out
